# icu

本项目用于提供快速开发基于Node的后端服务

## 设计原则

基于对`数据字段`的维护，快速生成对应的数据库，并根据数据库的表字段，提供简易的`代码模板`(增、删、改、查...)

## 环境准备

+ 操作系统 :
  + 支持 macOS，Linux，Windows
+ 语言使用 :
  + 建议选择 [LTS](https://nodejs。org/en/) 版本，最低要求 8.x。
+ 数据库 :
  + 选用MySQL作为底层数据库，5.5 以上版本

## 项目下载

TODO

## 安装依赖包

当环境准备完成，并将项目代码下载到本地后，进入项目根目录，在控制台执行命令，完成依赖包的安装。

命令如下:

```shell
npm install
```

## 将项目与Mysql连接

+ 在 Mysql 中创建一个数据库
  + eg: db_graduate
+ 确定 Mysql 的连接地址
  + eg: 127.0.0.1
+ 确定 Mysql 的连接端口
  + eg: 3306
+ 确定当 Mysql 的用户名
  + eg: root
+ 确定 Mysql 的密码
  + eg: 123456

以上信息确认后，修改项目中关于Mysql数据库连接的配置文件; 文件路径: `/项目根目录/database/config.json`

## 配置数据表结构

根据实际项目需求，配置数据库中对应的`表结构`，`表结构`配置文件路径: `/项目根目录/config/tables.js`

### 表配置项说明

| name                                                       | nameForChinese                                       | field              |
|------------------------------------------------------------|-----------------------------------------------|--------------------|
| 表的英文名称，单词小写，多个单词由下划线分隔， eg : shop_cart | 表的中文名称，用于代码中自动生成注释及消息提示 | 表中具体包含的字段，具体内容参见`字段配置项说明` |

### 字段配置项说明

因为每张表中都包含一些`通用字段`，所以在系统级别统一处理，无需在字段配置中进行配置。

通用字段如下:

| 字段名     | 类型    | 含义                        |
|------------|---------|-----------------------------|
| id         | INTEGER | 作为主键，自增长             |
| created_at | DATE    | 创建时间，创建记录时自动生产 |
| updated_at | DATE    | 修改时间，修改记录时自动修改 |

其他非通用字段，需要使用者手动配置，并指定对应的字段类型

需要注意的是，本项目并不提供关于`BOOLEAN`型的配置，如若有类似的需求，请以`INTEGER`型作为替代，使用`0`标识`false`，使用`1`标识`true`。

关于字段类型说明如下:

| 字段类型 | MySQL中数据类型 | 含义                                            |
|----------|-----------------|-------------------------------------------------|
| INTEGER  | INTEGER         | 类型：整型 最大值：范围(-2147483648~2147483647) |
| BIGINT   | BIGINT          | 类型：整型 最大值：范围(+-9.22*10的18次方)      |
| STRING   | VARCHAR(255)    | 类型：字符串 最大值： 65535个字符               |
| TEXT     | TEXT            | 类型：字符串 最大值：65535个字符                |
| FLOAT    | FLOAT           | 类型：单精度浮点型  8位精度(4字节)              |
| DOUBLE   | DOUBLE          | 类型：双精度浮点型 16位精度(8字节)              |
| DECIMAL  | DECIMAL         | 类型：定点数型                                  |
| DATE     | DATETIME        | 类型：日期时间类型 范例：'2009-05-12 02:31:44'  |

## 生成数据库中的表结构

当完成上述操作后，执行命令，一键生成所有对应的数据库表

命令如下:

```shell
npx sequelize db:migrate
```

若想将所有表删除，执行下列命令

```shell
npx sequelize db:migrate:undo
```

## 生成业务代码

当数据库相关均已配置完成，并且数据库表已生成后，执行命令，生成对应的业务代码

命令如下:

```shell
# 生成 controller service model 对应的代码
npm run init:all
# 仅生成 controller 对应的代码
# npm run init:controller
# 仅生成 service 对应的代码
# npm run init:service
# 仅生成 model 对应的代码
# npm run init:model
```

注: 若原本代码文件已经存在，执行此命令会强制覆盖导致原代码修改，请尽可能在`初次`进行项目初始化时执行

## 项目结构说明

```shell
project
├── package.json (项目整体配置文件(依赖包索引,启动命令...))
├── app
|   ├── router.js (全局路由通配)
│   ├── controller (接口请求入口)
│   ├── service (业务功能聚合模块,被controller调用)
│   ├── model (对应数据库中表结构)
│   ├── public (可选)
│   └── extend
│       ├── helper.js (内含数据查询的通用方法)
├── database (数据库初始化)
├── initialize (代码初始化)
├── config
|   ├── plugin.js (指定项目使用的插件)
└── ├── config.default.js (项目配置)
```

## 项目启动

执行命令启动项目:

```shell
npm run dev
```

项目默认端口为`7001`,项目启动后,访问地址为:[127.0.0.1:7001](http://127.0.0.1:7001)

若想修改启动端口,请打开`/项目目录/config/config.default.js`,寻找如下代码并修改:

```javascript
config.cluster = {
    listen: {
        port: 7001,
        hostname: '0.0.0.0',
    },
};
```

